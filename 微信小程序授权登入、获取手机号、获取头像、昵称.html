<div class="markdown-body cache"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;position:relative;background-image:linear-gradient(90deg,rgba(217,234,251,.25) 3%,transparent 0),linear-gradient(1turn,rgba(217,234,251,.25) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;padding-left:8px;padding-bottom:0;margin-top:35px;margin-bottom:10px;font-weight:900;font-family:serif;letter-spacing:1px;color:#000}.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover{background-color:#fff}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;position:relative}.markdown-body h2:after{content:"";left:0;bottom:0;width:100%;height:1px;position:absolute}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{height:1px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#37b2ff 0,#37b2ff 25%,transparent 50%)}.markdown-body code{margin:0 4px;word-break:break-word;overflow-x:auto;background-color:#fff7f7;color:#f06;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:-apple-system,system-ui,Menlo,Monaco,Consolas,Courier New;position:relative}.markdown-body pre{margin:15px 8px;border:1px solid #f5f5f7;line-height:1.75}.markdown-body pre:before{top:-4px;left:-4px;border-top:8px solid #feea1e;border-left:8px solid #feea1e}.markdown-body pre:after,.markdown-body pre:before{width:20px;height:20px;content:"";z-index:10;position:absolute}.markdown-body pre:after{right:-4px;bottom:-4px;border-right:8px solid #37b2ff;border-bottom:8px solid #37b2ff}.markdown-body pre>code{font-size:12px;padding:15px 12px;overflow-x:auto;margin:0;word-break:normal;display:block;color:#333;background-color:#fff;background-image:linear-gradient(135deg,hsla(0,0%,87.8%,.1),hsla(0,0%,87.8%,.1) 25%,transparent 0,transparent 50%,hsla(0,0%,87.8%,.1) 0,hsla(0,0%,87.8%,.1) 75%,transparent 0,transparent)!important;background-size:10px 10px!important;position:unset!important}.markdown-body a{margin:0 4px;text-decoration:none;color:#37b2ff;transition:.3s;border-bottom:1px dashed #37b2ff;position:relative;display:inline-block;vertical-align:bottom}.markdown-body a:before{bottom:90%;width:120px;max-width:0;content:"READ MORE +";color:#fff;background-color:#1fb3ff;position:absolute;white-space:nowrap;transition:.3s;box-sizing:border-box;pointer-events:none;overflow:hidden}.markdown-body a:active:before,.markdown-body a:hover:before{max-width:120px;padding-left:14px}.markdown-body table{width:100%;max-width:100%;font-size:12px;background-color:#fff;overflow:auto;border-collapse:collapse}.markdown-body table tr:hover td,.markdown-body table tr:hover th{border-bottom:1px solid #feea1e}.markdown-body thead{text-align:left}.markdown-body th{font-size:1.2em;border-bottom:1px dashed #eee}.markdown-body tr:nth-child(2n){background-color:hsla(0,0%,87.8%,.1);border-bottom:1px solid #fff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px;border-bottom:1px dashed #fff}.markdown-body blockquote{color:#666;padding:12px 23px 2px;border:1px solid #37b2ff;background-color:#fff;margin:22px 0;position:relative}.markdown-body blockquote>p{margin:10px 0}.markdown-body blockquote:after{content:"FROM";left:0;width:40px;color:#fff;background-color:#37b2ff;text-align:center}.markdown-body blockquote:after,.markdown-body blockquote:before{top:0;line-height:1;padding:2px 0;font-size:12px;font-weight:lighter;position:absolute;pointer-events:none}.markdown-body blockquote:before{content:"CITATION";left:44px;color:#37b2ff}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{line-height:2em;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol ol li,.markdown-body ol ul li,.markdown-body ul ol li,.markdown-body ul ul li{border-bottom:none}.markdown-body ol li{padding-left:6px;list-style:decimal-leading-zero}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox i]:disabled{background-color:#6cf}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre>code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>最近空闲之际在看了下小程序，期间肯定少不了微信小程序授权登入、获取手机号、获取头像、昵称这些逻辑，简单整理下这些逻辑</p>
<h3 data-id="heading-0">- 获取手机号</h3>
<ul>
<li>在按钮加上open-type="getPhoneNumber",手机号快速验证，向用户申请，并在用户同意后，快速填写和验证手机, 前提是微信小程序的主体是企业微信，并且在微信小程序的后台设置中“微信认证”，必须是已认证，这样才能正常获取到手机号，否则在获取的时候会报没有权限的。</li>
</ul>
<h2 data-id="heading-1"><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/580ff6fe233845679494d529c16118e0~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.image?" alt="image.png" loading="lazy"></h2>
<ul>
<li><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa3bbb59d9664fb08e0642cfa134cc29~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.image?" alt="WechatIMG263.jpg" loading="lazy"></li>
<li>bindgetphonenumber="getphonenumber"，回调中就能获取到了用户手机号，</li>
</ul>
<pre><code class="hljs language-js" lang="js">  &lt;van-button plain type=<span class="hljs-string">"primary"</span> open-type=<span class="hljs-string">"getPhoneNumber"</span> bindgetphonenumber=<span class="hljs-string">"getphonenumber"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"btn"</span>&gt;获取用户手机号&lt;/van-button&gt;

</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/66c9311268f14e7e87f03398f2bd6e53~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.image?" alt="WechatIMG265.jpg" loading="lazy"></p>
<ul>
<li>这样就能拿到微信返回的数据 将code或者其他标识通过调接口传给后端，后端即可返回用户手机号</li>
</ul>
<h3 data-id="heading-2">二 获取用户头像</h3>
<p>以下是微信小程序<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fcommunity%2Fdevelop%2Fdoc%2F00022c683e8a80b29bed2142b56c01" target="_blank" title="https://developers.weixin.qq.com/community/develop/doc/00022c683e8a80b29bed2142b56c01" ref="nofollow noopener noreferrer">公告</a></p>
<h4 data-id="heading-3">调整说明</h4>
<p>自 2022 年 10 月 25 日 24 时后（以下统称 “生效期” ），用户头像昵称获取规则将进行如下调整：</p>
<ol>
<li><strong>自生效期起，小程序 wx.getUserProfile 接口将被收回</strong>：生效期后发布的小程序新版本，通过 wx.getUserProfile 接口获取用户头像将统一返回默认<a href="https://link.juejin.cn?target=https%3A%2F%2Fmmbiz.qpic.cn%2Fmmbiz%2FicTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg%2F0" target="_blank" title="https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0" ref="nofollow noopener noreferrer">灰色头像</a>，昵称将统一返回 “微信用户”。生效期前发布的小程序版本不受影响，但如果要进行版本更新则需要进行适配。</li>
<li><strong>自生效期起，插件通过 wx.getUserInfo 接口获取用户昵称头像将被收回</strong>：生效期后发布的插件新版本，通过 wx.getUserInfo 接口获取用户头像将统一返回默认<a href="https://link.juejin.cn?target=https%3A%2F%2Fmmbiz.qpic.cn%2Fmmbiz%2FicTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg%2F0" target="_blank" title="https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0" ref="nofollow noopener noreferrer">灰色头像</a>，昵称将统一返回 “微信用户”。生效期前发布的插件版本不受影响，但如果要进行版本更新则需要进行适配。通过 wx.login 与 wx.getUserInfo 接口获取 openId、unionId 能力不受影响。</li>
<li><strong>「头像昵称填写能力」支持获取用户头像昵称</strong>：如业务需获取用户头像昵称，可以使用「<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2Fopen-ability%2FuserProfile.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/userProfile.html" ref="nofollow noopener noreferrer">头像昵称填写能力</a>」（基础库 2.21.2 版本开始支持，覆盖iOS与安卓微信 8.0.16 以上版本），具体实践可见下方《最佳实践》。</li>
<li><strong>小程序 wx.getUserProfile 与插件 wx.getUserInfo 接口兼容基础库 2.27.1 以下版本的头像昵称获取需求</strong>：对于来自低版本的基础库与微信客户端的访问，小程序通过 wx.getUserProfile 接口将正常返回用户头像昵称，插件通过 wx.getUserInfo 接口将正常返回用户头像昵称，开发者可继续使用以上能力做向下兼容。</li>
</ol>
<ul>
<li>在按钮上加上 open-type="chooseAvatar" bindchooseavatar="getBindChooseAvatar"</li>
</ul>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b9af4db4eb248f9a644e710087a7f5c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.image?" alt="WechatIMG268.jpg" loading="lazy"></p>
<p>后面我们再想要获取微信头像跟用户昵称的时候 得单独获取了，好坑。。。</p>
<h3 data-id="heading-4">二 获取用户昵称</h3>
<ul>
<li>用户昵称审核完毕后触发，仅在 type 为 "nickname" 时有效，event.detail = { pass, timeout }，</li>
<li>在input标签上加上 nickname | 昵称输入键盘。仅 Webview 支持，</li>
<li>在input标签加上 bindnicknamereview=“getNickName”，回调中可回显昵称。</li>
</ul>
<pre><code class="hljs language-js" lang="js">  &lt;input type=<span class="hljs-string">"nickname"</span> bindnicknamereview=<span class="hljs-string">"getNickName"</span> placeholder=<span class="hljs-string">"请输入昵称"</span> /&gt;

</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84e9aef5397649b7b187a86af7458d8c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.image?" alt="WechatIMG269.jpg" loading="lazy"></p>
<p>以上就是微信小程序授权登入、获取手机号、获取头像、昵称的方法了，如有不足，希望大家指正。</p></div>